<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Day 3 | Network Modeling for Epidemics | UW 2017" />


<title>Tutorial: SIS Epidemic in a One-Mode Network</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NME</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="prep.html">
    <span class="fa fa-book"></span>
     
    Prep
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-code"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Epidemics 101</li>
    <li>
      <a href="d1.html">Day 1</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Network Analysis</li>
    <li>
      <a href="d2.html">Day 2</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Independent Network Models</li>
    <li>
      <a href="d3.html">Day 3</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Dependent Network Models</li>
    <li>
      <a href="d4.html">Day 4</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Extending EpiModel</li>
    <li>
      <a href="d5.html">Day 5</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://epimodel.org/">
    <span class="fa fa-database"></span>
     
    EpiModel
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Tutorial: SIS Epidemic in a One-Mode Network</h1>
<h4 class="author"><em>Day 3 | Network Modeling for Epidemics | UW 2017</em></h4>

</div>


<p>EpiModel uses separable-temporal exponential-family random graph models (STERGMs) to estimate and simulate complete networks based on individual-level, dyad-level, and network-level patterns of density, degree, assortivity, and other features influencing edge formation and dissolution. Building and simulating a network-based epidemic models in EpiModel is a multi-step process, starting with estimation of a temporal ERGM and continuing with simulation of a dynamic network and epidemic processes on top of that network.</p>
<p>In this tutorial, we work through a model of a <em>Susceptible-Infected-Susceptible (SIS)</em> epidemic in a closed population. An example of an SIS disease would be a bacterial sexually transmitted infection such as <em>Gonorrhea</em>, in which persons may acquire infection from sexual contact with an infected partner, and then recover from infection either through natural clearance or through antibiotic treatment. We will use a simplifying assumption of a closed population, in which there are no entries or exits from the network; this may be justified by the short time span over which the epidemic will be simulated.</p>
<p>To get started, load the EpiModel library.</p>
<pre class="r"><code>library(EpiModel)</code></pre>
<div id="network-model-estimation" class="section level1">
<h1>Network Model Estimation</h1>
<p>The first step in our network model is to specify a network structure, including features like size and nodal attributes. The <code>network.initialize</code> function creates an object of class <code>network</code>. Below we show an example of initializing a network of 500 nodes, with no edges between them at the start. Edges represent sexual partnerships (mutual person-to-person contact), so this is an undirected network.</p>
<pre class="r"><code>nw &lt;- network.initialize(n = 500, directed = FALSE)</code></pre>
<p>The sizes of the networks represented in this workshop are small for computational efficiency. Larger network sizes over longer time intervals would ordinarily be used for research purposes.</p>
<div id="model-parameterization" class="section level2">
<h2>Model Parameterization</h2>
<p>This example will start simple, with a formula that represents the network density and the level of concurrency (overlapping sexual partnerships) in the population. This is a dyad-dependent model, since the probability of edge formation between any two nodes depends on the existence of edges between those nodes and other nodes. The concurrent term is defined as the number of nodes with at least two partners at any time. Following the notation of the <code>tergm</code> package, we specify this using a right-hand side (RHS) formula. In addition to concurrency, we will use a constraint on the degree distribution. This will cap the degree of any person at 3, with no nodes allowed to have 4 or more ongoing partnerships. This will replicate a truncated sampling scheme for partnerships within a survey (e.g., persons only asked about their 3 most recent partners).</p>
<pre class="r"><code>formation &lt;- ~edges + concurrent + degrange(from = 4)</code></pre>
<p>Target statistics will be the input mechanism for formation model terms. The <code>edges</code> term will be a function of mean degree, or the average number of ongoing partnerships. With an arbitrarily specified mean degree of 0.7, the corresponding target statistic is 175 (<code>edges = mean degree * (n / 2)</code>). We will also specify that 22% of edges exhibit concurrency, which is slightly higher than the 16% expected in a Poisson model conditional on that mean degree. The target statistic for the number of persons with a momentary degree of 4 or more is 0.</p>
<pre class="r"><code>target.stats &lt;- c(175, 110, 0)</code></pre>
<p>The dissolution model is parameterized from a mean partnership duration estimated from cross-sectional egocentric data. Dissolution models differ from formation models in two respects. First, the dissolution models are not estimated in an ERGM but instead passed in as a fixed coefficient conditional on which the formation model is to be estimated. The dissolution model terms are calculated analytically using the <code>dissolution_coefs</code> function, the output of which is passed into the <code>netest</code> model estimation function. Second, whereas formation models may be arbitrarily complex, dissolution models are limited to a set of dyad-independent models listed in the <code>dissolution_coefs</code> function help page. The model we will use is a simple edges-only model, implying a homogeneous probability of dissolution for all partnerships in the network. The average duration of these partnerships will be specified at 50 time steps, which will be days in our model.</p>
<pre class="r"><code>coef.diss &lt;- dissolution_coefs(dissolution = ~offset(edges), duration = 50)
coef.diss</code></pre>
<pre><code>Dissolution Coefficients
=======================
Dissolution Model: ~offset(edges)
Target Statistics: 50
Crude Coefficient: 3.89182
Mortality/Exit Rate: 0
Adjusted Coefficient: 3.89182</code></pre>
<p>The output from this function indicates both an adjusted and crude coefficient. In this case, they are equivalent. Upcoming tutorials will show a case when they differ as result of exits from the network.</p>
</div>
<div id="model-estimation-and-diagnostics" class="section level2">
<h2>Model Estimation and Diagnostics</h2>
<p>In EpiModel, network model estimation is performed with the <code>netest</code> function, which is a wrapper around the estimation functions in the <code>ergm</code> and <code>tergm</code> packages. The function arguments are as follows:</p>
<pre><code>function (nw, formation, target.stats, coef.diss, constraints, 
    coef.form = NULL, edapprox = TRUE, output = &quot;fit&quot;, set.control.ergm, 
    set.control.stergm, verbose = FALSE) 
NULL</code></pre>
<p>The four arguments that must be specified with each function call are:</p>
<ul>
<li><code>nw</code>: an initialized empty network.</li>
<li><code>formation</code>: a RHS formation formula..</li>
<li><code>target.stats</code>: target statistics for the formation model.</li>
<li><code>coef.diss</code>: output object from <code>dissolution_coefs</code>, containing the dissolution coefficients.</li>
</ul>
<p>Other arguments that may be helpful to understand when getting started are:</p>
<ul>
<li><code>constraints</code>: sets the model constraints, passed to <code>ergm</code> and <code>stergm</code> (see <code>help(&quot;ergm&quot;)</code>).</li>
<li><code>coef.form</code>: sets the coefficient values of any offset terms in the formation model.</li>
<li><code>edapprox</code>: selects the dynamic estimation method. If <code>TRUE</code>, uses the direct method, otherwise the approximation method.
<ul>
<li><em>Direct method:</em> uses the functionality of the <code>tergm</code> package to estimate the separable formation and dissolution models for the network.</li>
<li><em>Approximation method:</em> uses <code>ergm</code> estimation for a cross-sectional network (the prevalence of edges) with an analytic adjustment of the edges coefficient to account for dissolution (i.e., transformation from prevalence to incidence). This approximation method may introduce bias into estimation in certain cases (high density and short durations) but these are typically not a concern for the low density cases in epidemiologically relevant networks.</li>
</ul></li>
</ul>
<div id="estimation" class="section level3">
<h3>Estimation</h3>
<p>Because we have a dyad-dependent model, MCMC will be used to estimate the coefficients of the model given the target statistics.</p>
<pre class="r"><code>est &lt;- netest(nw, formation, target.stats, coef.diss)</code></pre>
</div>
<div id="diagnostics" class="section level3">
<h3>Diagnostics</h3>
<p>There are two forms of model diagnostics for a dynamic ERGM fit with <code>netest</code>: static and dynamic diagnostics. When the approximation method has been used, static diagnostics check the fit of the cross-sectional model to target statistics. Dynamic diagnostics check the fit of the model adjusted to account for edge dissolution.</p>
<p>When running a dynamic network simulation, it is good to <em>start</em> with the <strong>dynamic diagnostics,</strong> and if there are fit problems, work back to the <strong>static diagnostics</strong> to determine if the problem is due to the cross-sectional fit itself or with the dynamic adjustment (i.e., the approximation method). A proper fitting ERGM using the approximation method does not guarantee well-performing dynamic simulations.</p>
<p>Here we will examine dynamic diagnostics only. These are run with the <code>netdx</code> function, which simulates from the model fit object returned by <code>netest</code>. One must specify the number of simulations from the dynamic model and the number of time steps per simulation. Choice of both simulation parameters depends on the stochasticity in the model, which is a function of network size, model complexity, and other factors. The <code>nwstats.formula</code> contains the network statistics to monitor in the diagnostics: it may contain statistics in the formation model and also others. By default, it is the formation model.</p>
<pre class="r"><code>dx &lt;- netdx(est, nsims = 10, nsteps = 1000,
            nwstats.formula = ~edges + meandeg + degree(0:4) + concurrent)</code></pre>
<p>Printing the object will show the object structure and diagnostics. Both Formation and duration diagnostics show a good fit relative to their targets. For the formation diagnostics, the mean statistics are the mean of the cross sectional statistics at each time step across all simulations. The <code>Pct Diff</code> column shows the relative difference between the mean and targets. There are two forms of dissolution diagnostics. The edge duration row shows the mean duration of partnerships across the simulations; it tends to be lower than the target unless the diagnostic simulation interval is very long since its average includes a burn-in period where all edges start at a duration of zero (illustrated below in the plot). The next row shows the percent of current edges dissolving at each time step, and is not subject to bias related to burn-in. The percentage of edges dissolution is the inverse of the expected duration: if the duration is 50 days, then we expect that 1/50 or 2% dissolve each day.</p>
<pre class="r"><code>dx</code></pre>
<pre><code>EpiModel Network Diagnostics
=======================
Diagnostic Method: Dynamic
Simulations: 10
Time Steps per Sim: 1000

Formation Diagnostics
----------------------- 
           Target Sim Mean Pct Diff Sim SD
edges         175  179.462    0.025 14.369
meandeg        NA    0.718       NA  0.057
degree0        NA  268.114       NA 15.370
degree1        NA  118.813       NA  9.675
degree2        NA   99.107       NA 11.298
degree3        NA   13.966       NA  4.172
degree4        NA    0.000       NA  0.000
concurrent    110  113.073    0.028 12.753
deg4+           0       NA       NA     NA

Dissolution Diagnostics
----------------------- 
               Target Sim Mean Pct Diff Sim SD
Edge Duration   50.00   47.465   -0.051  47.01
Pct Edges Diss   0.02    0.020    0.001   0.01</code></pre>
<p>Plotting the diagnostics object will show the time series of the target statistics against any targets. The other options used here specify to smooth the mean lines, give them a thicker line width, and plot each statistic in a separate panel. The black dashed lines show the value of the target statistics for any terms in the model. Similiar to the numeric summaries, the plots show a good fit over the time series.</p>
<pre class="r"><code>plot(dx)</code></pre>
<p><img src="d3-s2_files/figure-html/plotDx-1.png" width="672" /></p>
<p>The dissolution model fit may also be assessed with plots by specifying either the <code>duration</code> or <code>dissolution</code> type, as defined above. The duration diagnostic is based on the average age of edges at each time step, up to that time step; there is a <em>burn-in period</em> because edges at <span class="math inline">\(t_1\)</span> are censored. Both metrics show a good fit of the dissolution model to the target duration of 50 time steps.</p>
<pre class="r"><code>par(mfrow = c(1, 2))
plot(dx, type = &quot;duration&quot;, mean.col = &quot;black&quot;)
plot(dx, type = &quot;dissolution&quot;, qnts = 0.5, 
     mean.lines = FALSE, sim.lines = FALSE)</code></pre>
<p><img src="d3-s2_files/figure-html/plotDx2-1.png" width="672" /></p>
<p>If the model diagnostics had suggested poor fit, then additional diagnostics and fitting would be necessary. If using the approximation method, one should first start by running the cross-sectional diagnostics (see the <code>dynamic</code> argument in <code>netdx</code>). Note that the number of simulations may be very large here and there are no time steps specified because each simulation is a cross-sectional network.</p>
<pre class="r"><code>dx.static &lt;- netdx(est, nsims = 10000, dynamic = FALSE)
dx.static</code></pre>
<p>If the cross-sectional model fits well but the dynamic model does not, then a full STERGM estimation may be necessary. If the cross-sectional model does not fit well, different control parameters for the ERGM estimation may be necessary (see the help file for <code>netdx</code> for instructions).</p>
</div>
</div>
</div>
<div id="epidemic-simulation" class="section level1">
<h1>Epidemic Simulation</h1>
<p>EpiModel simulates disease epidemics over dynamic networks by integrating dynamic model simulations with the simulation of other epidemiological processes such as disease transmission and recovery. Like the network model simulations, these processes are also simulated stochastically so that the range of potential outcomes under the model specifications is estimated. The specification of epidemiological processes to model may be arbitrarily complex, but EpiModel includes a number of “built-in” model types within the software. Additional components must be programmed and plugged into the simulation API. Here, we will start simple with an SIS epidemic using this built-in functionality.</p>
<div id="epidemic-model-parameters" class="section level2">
<h2>Epidemic Model Parameters</h2>
<p>Our SIS model will rely on three parameters. The <em>act rate</em> is the number of sexual acts between that occur within a partnership each time unit. The overall frequency of acts per person per unit time is a function of the incidence rate of partnerships and this act parameter. The <em>infection probability</em> is the risk of transmission given contact with an infected person. The <em>recovery rate</em> for an SIS epidemic is the speed at which infected persons become susceptible again. For a bacterial STI like gonorrhea, this may be a function of biological attributes like gender or use of curative agents like antibiotics.</p>
<p>EpiModel uses three helper functions to input epidemic parameters, initial conditions, and other control settings for the epidemic model. First, we use the <code>param.net</code> function to input the per-act transmission probability in <code>inf.prob</code> and the number of acts per partnership per unit time in <code>act.rate</code>. The recovery rate implies that the average duration of disease is 100 days.</p>
<pre class="r"><code>param &lt;- param.net(inf.prob = 0.4, act.rate = 2, rec.rate = 0.01)</code></pre>
<p>For initial conditions in this model, we only need to specify the number of infected persons at the outset of the epidemic. The remaining persons in the network will be classified as disease susceptible.</p>
<pre class="r"><code>init &lt;- init.net(i.num = 10)</code></pre>
<p>The control settings specify the structural elements of the model. These include the disease type, number of simulations, and number of time steps per simulation. The <code>verbose.int</code> argument specifies the level of model progress to print to the console: 0 means to print output that a full simulation has finished, whereas a positive number <span class="math inline">\(x\)</span> will print out the simulations at every <span class="math inline">\(x\)</span> time steps.</p>
<pre class="r"><code>control &lt;- control.net(type = &quot;SIS&quot;, nsims = 5, nsteps = 500, verbose.int = 0)</code></pre>
</div>
<div id="simulating-the-epidemic-model" class="section level2">
<h2>Simulating the Epidemic Model</h2>
<p>Once the model has been parameterized, simulating the model is straightforward. One must pass the fitted network model object from <code>netest</code> along with the parameters, initial conditions, and control settings to the <code>netsim</code> function. With an independent model like this (i.e., there are no vital dynamic parameters), the full dynamic network time series is simulated at the start of each epidemic simulation, and then the epidemiological processes are simulated over that structure.</p>
<pre class="r"><code>sim &lt;- netsim(est, param, init, control)</code></pre>
<p>Printing the model output lists the inputs and outputs of the model. The output includes the sizes of the compartments (<code>s.num</code> is the number susceptible and <code>i.num</code> is the number infected) and flows (<code>si.flow</code> is the number of infections and <code>is.flow</code> is the number of recoveries). Methods for extracting this output is discussed below.</p>
<pre class="r"><code>sim</code></pre>
<pre><code>EpiModel Simulation
=======================
Model class: netsim

Simulation Summary
-----------------------
Model type: SIS
No. simulations: 5
No. time steps: 500
No. NW modes: 1

Model Parameters
-----------------------
inf.prob = 0.4
act.rate = 2
rec.rate = 0.01

Model Output
-----------------------
Variables: s.num i.num num is.flow si.flow
Networks: sim1 ... sim5
Transmissions: sim1 ... sim5</code></pre>
</div>
<div id="model-analysis" class="section level2">
<h2>Model Analysis</h2>
<p>Now the the model has been simulated, the next step is to analyze the data. This includes plotting the epidemiological output, the networks over time, and extracting the data.</p>
<div id="epidemic-plots" class="section level3">
<h3>Epidemic Plots</h3>
<p>Plotting the output from the epidemic model using the default arguments will display the size of the compartments in the model across simulations. The means across simulations at each time step are plotted with lines, and the polygon band shows the inter-quartile range across simulations.</p>
<pre class="r"><code>par(mfrow = c(1, 1))
plot(sim)</code></pre>
<p><img src="d3-s2_files/figure-html/plotSim2-1.png" width="672" /></p>
<p>Graphical elements may be toggled on and off. The <code>popfrac</code> argument specifies whether to use the absolute size of compartments versus proportions.</p>
<pre class="r"><code>par(mfrow = c(1, 2))
plot(sim, sim.lines = TRUE, mean.line = FALSE, qnts = FALSE, popfrac = TRUE)
plot(sim, mean.smooth = FALSE, qnts = 1, qnts.smooth = FALSE, popfrac = TRUE)</code></pre>
<p><img src="d3-s2_files/figure-html/plotSim3-1.png" width="672" /></p>
<p>Whereas the default will print the compartment proportions, other elements of the simulation may be plotted by name with the <code>y</code> argument. Here we plot both flow sizes using smoothed means, which converge at model equilibrium by the end of the time series.</p>
<pre class="r"><code>par(mfrow = c(1,1))
plot(sim, y = c(&quot;si.flow&quot;, &quot;is.flow&quot;), qnts = FALSE, 
     ylim = c(0, 10), legend = TRUE, main = &quot;Flow Sizes&quot;)</code></pre>
<p><img src="d3-s2_files/figure-html/plotSim4-1.png" width="672" /></p>
</div>
<div id="network-plots" class="section level3">
<h3>Network Plots</h3>
<p>Another available plot type is a network plot to visualize the individual nodes and edges at a specific time point. Network plots are output by setting the <code>type</code> parameter to <code>&quot;network&quot;</code>. To plot the disease infection status on the nodes, use the <code>col.status</code> argument: blue indicates susceptible and red infected. It is necessary to specify both a time step and a simulation number to plot these networks.</p>
<pre class="r"><code>par(mar = c(0, 0, 0, 0), mfrow = c(1, 2))
plot(sim, type = &quot;network&quot;, col.status = TRUE, at = 1, sims = 1)
plot(sim, type = &quot;network&quot;, col.status = TRUE, at = 500, sims = 1)</code></pre>
<p><img src="d3-s2_files/figure-html/plotSimNet1-1.png" width="672" /></p>
</div>
<div id="time-specific-model-summaries" class="section level3">
<h3>Time-Specific Model Summaries</h3>
<p>The summary function with the output of <code>netsim</code> will show the model statistics at a specific time step. Here we output the statistics at the final time step, where roughly two-thirds of the population are infected.</p>
<pre class="r"><code>summary(sim, at = 500)</code></pre>
<pre><code>
EpiModel Summary
=======================
Model class: netsim

Simulation Details
-----------------------
Model type: SIS
No. simulations: 5
No. time steps: 500
No. NW modes: 1

Model Statistics
------------------------------
Time: 500 
------------------------------ 
           mean      sd    pct
Suscept.  146.8  16.407  0.294
Infect.   353.2  16.407  0.706
Total     500.0   0.000  1.000
S -&gt; I      4.8   1.924     NA
I -&gt; S      3.6   2.074     NA
------------------------------ </code></pre>
</div>
<div id="data-extraction" class="section level3">
<h3>Data Extraction</h3>
<p>The <code>as.data.frame</code> function may be used to extract the model output into a data frame object for easy analysis outside of the built-in EpiModel functions. The function default will output means across all simulations for each time step.</p>
<pre class="r"><code>df &lt;- as.data.frame(sim)
head(df, 10)</code></pre>
<pre><code>   time s.num i.num num is.flow si.flow
1     1 490.0  10.0 500     0.0     0.0
2     2 486.4  13.6 500     0.0     3.6
3     3 484.4  15.6 500     0.0     2.0
4     4 482.2  17.8 500     0.0     2.2
5     5 480.6  19.4 500     0.0     1.6
6     6 479.0  21.0 500     0.2     1.8
7     7 478.2  21.8 500     0.2     1.0
8     8 476.2  23.8 500     0.0     2.0
9     9 474.8  25.2 500     0.4     1.8
10   10 473.0  27.0 500     0.2     2.0</code></pre>
<p>The <code>out</code> argument may be changed to specify the output of standard deviations across the models (with <code>out = &quot;sd&quot;</code>), as well as values from individual simulations (with <code>out = &quot;vals&quot;</code>). For the latter, it is also necessary to specify which simulation to output. The output below shows all compartment and flow sizes as integers, reinforcing this as an individual-level model.</p>
<pre class="r"><code>df &lt;- as.data.frame(sim, out = &quot;vals&quot;, sim = 5)
head(df, 10)</code></pre>
<pre><code>   time s.num i.num num is.flow si.flow
1     1   490    10 500       0       0
2     2   488    12 500       0       2
3     3   485    15 500       0       3
4     4   484    16 500       0       1
5     5   483    17 500       0       1
6     6   483    17 500       0       0
7     7   483    17 500       0       0
8     8   482    18 500       0       1
9     9   481    19 500       0       1
10   10   478    22 500       0       3</code></pre>
<p>The <code>networkDynamic</code> objects are stored in the <code>netsim</code> object, and may be extracted with the <code>get_network</code> function. By default the dynamic networks are saved, and contain the full edge history for every node that has existed in the network, along with the disease status history of those nodes.</p>
<pre class="r"><code>nw1 &lt;- get_network(sim, sim = 1)
nw1</code></pre>
<pre><code>NetworkDynamic properties:
  distinct change times: 502 
  maximal time range: -Inf until  Inf 

 Dynamic (TEA) attributes:
  Vertex TEAs:    testatus.active 

Includes optional net.obs.period attribute:
 Network observation period info:
  Number of observation spells: 2 
  Maximal time range observed: 1 until 501 
  Temporal mode: discrete 
  Time unit: step 
  Suggested time increment: 1 

 Network attributes:
  vertices = 500 
  directed = FALSE 
  hyper = FALSE 
  loops = FALSE 
  multiple = FALSE 
  bipartite = FALSE 
  net.obs.period: (not shown)
  vertex.pid = vertex.pid 
  edge.pid = edge.pid 
  total edges= 1982 
    missing edges= 0 
    non-missing edges= 1982 

 Vertex attribute names: 
    active testatus.active vertex.names vertex.pid 

 Edge attribute names not shown </code></pre>
<p>A matrix is stored that records some key details about each transmission event that occurred. Shown below are the first 10 transmission events for simulation number 1. The <code>sus</code> column shows the unique ID of the previously susceptible, newly infected node in the event. The <code>inf</code> column shows the ID of the transmitting node. The other columns show the duration of the transmitting node’s infection at the time oftransmission, the per-act transmission probability, act rate during the transmission, and final per-partnership transmission rate (which is the per-act probability raised to the number of acts).</p>
<pre class="r"><code>tm1 &lt;- get_transmat(sim, sim = 1)
head(tm1, 10)</code></pre>
<pre><code>   at          sus          inf infDur transProb actRate finalProb
1   2  6633fb44b4d 6633506050c7     11       0.4       2      0.64
2   3 66337212b1c3  6633fb44b4d      1       0.4       2      0.64
3   4 66335c36d700 66334fb62e27     17       0.4       2      0.64
4   5 66336e521581 663324027d0d     88       0.4       2      0.64
5   5 663372fa2fbc 663324027d0d     88       0.4       2      0.64
6   6  663335f5d19 66335c36d700      2       0.4       2      0.64
7   6  66332779806 66336e521581      1       0.4       2      0.64
8  20 66336e521581 663324027d0d    103       0.4       2      0.64
9  22 6633489f780a 66334fb62e27     35       0.4       2      0.64
10 23 66336e521581 663324027d0d    106       0.4       2      0.64</code></pre>
<br>
<hr style="background-color:#909090;height:1px;width:100%">
<p><small> <em>Last updated:</em> 2017-08-15 with EpiModel v1.5.1 </small></p>
</div>
</div>
</div>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-56272534-1', 'auto');
ga('require', 'displayfeatures');
ga('send', 'pageview');

</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
